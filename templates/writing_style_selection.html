{% extends "base.html" %}

{% block title %}Select Writing Style{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('index') }}">Story Types</a> > 
    <a href="{{ url_for('story_type_detail', story_type_name=story.story_type_name) }}">{{ story.story_type_name }}</a> > 
    <a href="{{ url_for('subtype_detail', story_type_name=story.story_type_name, subtype_name=story.subtype_name) }}">{{ story.subtype_name }}</a> > 
    <a href="{{ url_for('genre_selection') }}">Genre Selection</a> >
    <a href="{{ url_for('subgenre_selection') }}">Sub-Genre Selection</a> >
    Writing Style Selection
</div>

<h1>Select a Writing Style</h1>
<h2>Step 5: Choose your writing style</h2>

{% if story.key_theme and story.core_arc and story.genre and story.sub_genre %}
<div class="section">
    <div class="section-title">Your Story So Far</div>
    <div class="section-content">
        <strong>Story Type:</strong> {{ story.story_type_name }} - {{ story.subtype_name }}<br>
        <strong>Key Theme:</strong> {{ story.key_theme }}<br>
        <strong>Core Arc:</strong> {{ story.core_arc }}<br>
        <strong>Genre:</strong> {{ story.genre.name }}<br>
        <strong>Sub-Genre:</strong> {{ story.sub_genre.name }}
    </div>
</div>
{% endif %}

<div class="section">
    <div class="section-title">Available Writing Styles</div>
    <div class="section-content">
        <form method="POST" action="{{ url_for('update_writing_style_selection') }}" class="story-selection-form">
            <div class="selection-section">
                <div class="story-types-grid">
                    {% for style in writing_styles %}
                    <div class="story-type-card writing-style-card" onclick="selectWritingStyle('{{ style.name }}')">
                        <div class="story-type-left">
                            <div class="story-type-title">{{ style.name }}</div>
                            <div class="writing-style-description">{{ style.description }}</div>
                            {% if style.examples %}
                            <div class="writing-style-examples">Examples: {{ style.examples | join(', ') }}</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <input type="hidden" name="writing_style" id="selected_writing_style" value="{{ story.writing_style.name if story.writing_style else '' }}">
            </div>
        </form>
    </div>
</div>

<a href="{{ url_for('subgenre_selection') }}" class="back-link">‚Üê Back to Sub-Genre Selection</a>

<style>
.writing-style-card {
    min-height: 120px;
}

.writing-style-description {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 0.5rem;
    line-height: 1.4;
}

.writing-style-examples {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    font-style: italic;
}
</style>

<script>
function selectWritingStyle(styleName) {
    // Update hidden input
    document.getElementById('selected_writing_style').value = styleName;
    
    // Update visual selection
    const cards = document.querySelectorAll('.writing-style-card');
    cards.forEach(card => card.classList.remove('selected'));
    
    // Find and select the clicked card
    const clickedCard = event.currentTarget;
    clickedCard.classList.add('selected');
    
    // Auto-submit the form immediately
    document.querySelector('.story-selection-form').submit();
}

// Initialize selection if writing style is already selected
document.addEventListener('DOMContentLoaded', function() {
    const selectedStyle = document.getElementById('selected_writing_style').value;
    if (selectedStyle) {
        const cards = document.querySelectorAll('.writing-style-card');
        cards.forEach(card => {
            if (card.querySelector('.story-type-title').textContent.trim() === selectedStyle) {
                card.classList.add('selected');
            }
        });
    }
});
</script>
{% endblock %}