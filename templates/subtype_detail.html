{% extends "base.html" %}

{% block title %}{{ subtype.name }} - {{ story_type.name }}{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('index') }}">Story Types</a> > 
    <a href="{{ url_for('story_type_detail', story_type_name=story_type.name) }}">{{ story_type.name }}</a> > 
    {{ subtype.name }}
</div>

<h1>{{ subtype.name }}</h1>
<h2>{{ story_type.name }} Subtype</h2>

<div class="section">
    <div class="section-title">Description</div>
    <div class="section-content">{{ subtype.description }}</div>
</div>

{% if subtype.examples %}
<div class="section">
    <div class="section-title">Examples</div>
    <div class="section-content">{{ subtype.examples | join(', ') }}</div>
</div>
{% endif %}

<div class="section">
    <div class="section-title">Parent Story Type</div>
    <div class="section-content">{{ story_type.description }}</div>
</div>

<!-- Selectable story elements form -->
<form method="POST" action="{{ url_for('update_story_selection', story_type_name=story_type.name, subtype_name=subtype.name) }}" class="story-selection-form">
    
    {% if story_type.key_theme %}
    <div class="selection-section">
        <div class="section-title">Key Theme</div>
        <div class="radio-group">
            {% for theme in story_type.key_theme %}
            <label class="radio-label">
                <input type="radio" name="key_theme" value="{{ theme }}" 
                    {% if saved_selections.get('key_theme') == theme or (not saved_selections.get('key_theme') and loop.first) %}checked{% endif %}>
                <span class="radio-text">{{ theme }}</span>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if story_type.core_arc %}
    <div class="selection-section">
        <div class="section-title">Core Arc</div>
        <div class="radio-group">
            {% for arc in story_type.core_arc %}
            <label class="radio-label">
                <input type="radio" name="core_arc" value="{{ arc }}" 
                    {% if saved_selections.get('core_arc') == arc or (not saved_selections.get('core_arc') and loop.first) %}checked{% endif %}>
                <span class="radio-text">{{ arc }}</span>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <button type="submit" class="submit-button">Save Selections</button>
</form>

<!-- Show complete story information if all selections are made -->
{% if saved_selections.get('key_theme') and saved_selections.get('core_arc') %}
<div class="section">
    <div class="section-title">Your Current Selections</div>
    <div class="section-content">
        <strong>Story Type:</strong> {{ story_type.name }} - {{ subtype.name }}<br>
        <strong>Key Theme:</strong> {{ saved_selections.get('key_theme') }}<br>
        <strong>Core Arc:</strong> {{ saved_selections.get('core_arc') }}
        {% if saved_selections.get('genre_name') %}
        <br><strong>Genre:</strong> {{ saved_selections.get('genre_name') }}
        {% endif %}
        {% if saved_selections.get('sub_genre_name') %}
        <br><strong>Sub-Genre:</strong> {{ saved_selections.get('sub_genre_name') }}
        {% endif %}
    </div>
    
    {% if not saved_selections.get('genre_name') %}
    <div class="next-step">
        <a href="{{ url_for('genre_selection') }}" class="submit-button">Continue to Genre Selection →</a>
    </div>
    {% elif not saved_selections.get('sub_genre_name') %}
    <div class="next-step">
        <a href="{{ url_for('subgenre_selection') }}" class="submit-button">Continue to Sub-Genre Selection →</a>
    </div>
    {% else %}
    <div class="completion-message">
        <strong>✅ Story Selection Complete!</strong>
    </div>
    {% endif %}
</div>
{% endif %}

<a href="{{ url_for('story_type_detail', story_type_name=story_type.name) }}" class="back-link">← Back to {{ story_type.name }}</a>
{% endblock %}