{% extends "base.html" %}

{% block title %}{{ subtype.name }} - {{ story_type.name }}{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('index') }}">Story Types</a> > 
    <a href="{{ url_for('story_type_detail', story_type_name=story_type.name) }}">{{ story_type.name }}</a> > 
    {{ subtype.name }}
</div>

<h1>{{ subtype.name }}</h1>
<h2>{{ story_type.name }} Subtype</h2>

<div class="section">
    <div class="section-title">Description</div>
    <div class="section-content">{{ subtype.description }}</div>
</div>

{% if subtype.examples %}
<div class="section">
    <div class="section-title">Examples</div>
    <div class="section-content">{{ subtype.examples | join(', ') }}</div>
</div>
{% endif %}

<div class="section">
    <div class="section-title">Parent Story Type</div>
    <div class="section-content">{{ story_type.description }}</div>
</div>

<!-- Selectable story elements form -->
<form method="POST" action="{{ url_for('update_story_selection', story_type_name=story_type.name, subtype_name=subtype.name) }}" class="story-selection-form">
    {% set session_key = story_type.name + "_" + subtype.name %}
    {% set saved_selections = session.get('story_selections', {}).get(session_key, {}) %}
    
    {% if story_type.key_theme %}
    <div class="selection-section">
        <div class="section-title">Key Theme</div>
        <div class="radio-group">
            {% for theme in story_type.key_theme %}
            <label class="radio-label">
                <input type="radio" name="key_theme" value="{{ theme }}" 
                    {% if saved_selections.get('key_theme') == theme or (not saved_selections.get('key_theme') and loop.first) %}checked{% endif %}>
                <span class="radio-text">{{ theme }}</span>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if story_type.key_moment %}
    <div class="selection-section">
        <div class="section-title">Key Moment</div>
        <div class="radio-group">
            {% for moment in story_type.key_moment %}
            <label class="radio-label">
                <input type="radio" name="key_moment" value="{{ moment }}" 
                    {% if saved_selections.get('key_moment') == moment or (not saved_selections.get('key_moment') and loop.first) %}checked{% endif %}>
                <span class="radio-text">{{ moment }}</span>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if story_type.core_arc %}
    <div class="selection-section">
        <div class="section-title">Core Arc</div>
        <div class="radio-group">
            {% for arc in story_type.core_arc %}
            <label class="radio-label">
                <input type="radio" name="core_arc" value="{{ arc }}" 
                    {% if saved_selections.get('core_arc') == arc or (not saved_selections.get('core_arc') and loop.first) %}checked{% endif %}>
                <span class="radio-text">{{ arc }}</span>
            </label>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <button type="submit" class="submit-button">Save Selections</button>
</form>

<a href="{{ url_for('story_type_detail', story_type_name=story_type.name) }}" class="back-link">‚Üê Back to {{ story_type.name }}</a>
{% endblock %}